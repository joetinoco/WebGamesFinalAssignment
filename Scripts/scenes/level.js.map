{"version":3,"sources":["scenes/level.ts"],"names":[],"mappings":"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","file":"scenes/level.js","sourcesContent":["// MENU SCENE\r\nmodule scenes {\r\n    export class Level extends objects.Scene {\r\n        //PRIVATE INSTANCE VARIABLES ++++++++++++\r\n        private _backgroundImage: createjs.Bitmap;\r\n        private _startButton: objects.Button;\r\n        private _levelElements: any;\r\n\r\n        // Game Objects\r\n        private _hero: objects.Hero;\r\n        private _enemy: objects.Hero;\r\n        private _exitDoor: objects.ExitDoor;\r\n\r\n        // Level status flags\r\n        private _playerLost: boolean;\r\n        \r\n        // Level music & sounds\r\n        private _levelMusic: objects.Sound;\r\n        private _lostLife: objects.Sound;\r\n        \r\n\r\n        // CONSTRUCTOR ++++++++++++++++++++++\r\n        constructor(levelElements) {\r\n            super();\r\n            this._levelElements = levelElements;\r\n            this.start();\r\n        }\r\n\r\n        // PUBLIC METHODS +++++++++++++++++++++\r\n\r\n        // Start Method\r\n        public start(): void {\r\n            var self = this;\r\n            \r\n            // add background image to the scene\r\n            this._backgroundImage = new createjs.Bitmap(managers.Assets.loader.getResult(this._levelElements.background));\r\n            this.addChild(this._backgroundImage);\r\n            \r\n            // Add music\r\n            this._levelMusic = new objects.Sound(this._levelElements.music);\r\n            this._levelMusic.play(-1); // -1 means loop indefinitely\r\n            \r\n            // Add SFX\r\n            this._lostLife = new objects.Sound('loselife');\r\n\r\n            // Add platforms\r\n            this._levelElements.platforms.forEach(function(elem) {\r\n                var wall = new objects.Platform(elem.x, elem.y, elem.width, elem.height, elem.isPlatform);\r\n                self.addChild(wall.view);\r\n            });\r\n            \r\n            // Add images\r\n            this._levelElements.images.forEach(function(elem) {\r\n                var image = new createjs.Bitmap(managers.Assets.loader.getResult(elem.asset));\r\n                image.x = elem.x;\r\n                image.y = elem.y;\r\n                self.addChild(image);\r\n            });\r\n\r\n            // Add hero and enemy\r\n            this._hero = new objects.Hero(\r\n                this._levelElements.heroStartPoint.x,\r\n                this._levelElements.heroStartPoint.y,\r\n                false);\r\n            this.addChild(this._hero.view);\r\n\r\n            this._enemy = new objects.Hero(\r\n                this._levelElements.enemyStartPoint.x,\r\n                this._levelElements.enemyStartPoint.y,\r\n                true);\r\n            this.addChild(this._enemy.view);\r\n\r\n            // Add exit door\r\n            this._exitDoor = new objects.ExitDoor(\r\n                this._levelElements.exitDoorLocation.x,\r\n                this._levelElements.exitDoorLocation.y)\r\n            this.addChild(this._exitDoor.view);\r\n\r\n            var fixDef = new box2d.b2FixtureDef;\r\n            fixDef.density = 0.5;\r\n            fixDef.friction = 0.2;\r\n            fixDef.restitution = 0.5;\r\n\r\n            var bodyDef = new box2d.b2BodyDef;\r\n            var fixDefShape;\r\n\r\n            // Add event listener for collisions\r\n            var listener = new Box2D.Dynamics.b2ContactListener;\r\n            listener.BeginContact = this._evaluateCollision;\r\n            world.SetContactListener(listener);\r\n\r\n            // Add event listener for collision resets \r\n            this.on('playerLost', this._reset, this);\r\n            this.on('playerWon', this._nextLevel, this);\r\n\r\n            // Set scene status\r\n            this._playerLost = false;\r\n            \r\n            // add this scene to the global stage container\r\n            stage.addChild(this);\r\n            \r\n            // Show score board\r\n            scoreboard.showScoreBoard();\r\n            scoreboard.restartCountdown();\r\n        }\r\n\r\n        // LEVEL Scene updates here\r\n        public update(): void {\r\n            if(scoreboard.countdown == 0) this._playerLost = true;\r\n\r\n            this._hero.update(this._playerLost);\r\n            this._enemy.update(this._playerLost);\r\n            this._checkGameStatus();\r\n            \r\n            scoreboard.update();\r\n            reality.update();\r\n        }\r\n        \r\n        public destroy(): void {\r\n            this._levelMusic.stop();\r\n        }\r\n        \r\n        private _checkGameStatus(): void { \r\n            if(this._playerLost){\r\n                this._lostLife.play();\r\n                scoreboard.lives--;\r\n                scoreboard.restartCountdown();\r\n                // Reset lost life flag\r\n                this._playerLost = false;\r\n            }\r\n            if(scoreboard.lives < 0){\r\n                this.destroy();\r\n                scene = config.Scene.GAME_OVER;\r\n                changeScene();\r\n            }\r\n        }\r\n\r\n        // Reset the level\r\n        private _reset(): void {\r\n            this._playerLost = true;\r\n        }\r\n        \r\n        // Switch to the next level\r\n        private _nextLevel(): void {\r\n            scoreboard.stopCountdown();\r\n            scoreboard.score += scoreboard.countdown;\r\n            \r\n            scene += 1;\r\n            changeScene();\r\n        }\r\n\r\n\r\n        //EVENT HANDLERS ++++++++++++++++++++\r\n\r\n        // Treat collisions \r\n        protected _evaluateCollision(contact) {\r\n            var objA = contact.GetFixtureA().GetBody().GetUserData();\r\n            var objB = contact.GetFixtureB().GetBody().GetUserData();\r\n            if (objA && objB) {\r\n                var collided = [objA.objType, objB.objType];\r\n\r\n                //console.log('Collision between ' + objA.objType + ' and ' + objB.objType);\r\n\r\n                // Treat hero collisions\r\n                if (collided.indexOf('hero') > -1) {\r\n                    if (collided.indexOf('enemy') > -1) {\r\n                        console.log('You touched the enemy. Lose a life'); \r\n                        currentScene.dispatchEvent('playerLost');\r\n                    } else if (collided.indexOf('exit door') > -1) {\r\n                        console.log('Level complete! You win!');\r\n                        currentScene.dispatchEvent('playerWon');\r\n                    }\r\n                } else if (collided.indexOf('enemy') > -1 && collided.indexOf('exit door') > -1) {\r\n                    console.log('The enemy reached the door. Lose a life.');\r\n                    currentScene.dispatchEvent('playerLost');\r\n                }\r\n            }\r\n        }\r\n    }\r\n}"],"sourceRoot":"/source/"}